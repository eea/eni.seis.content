<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone.app.event">

<head>
  <metal:styleslot fill-slot="style_slot">
    <style>
      form .field {
        padding: 1rem;
      }

      .field label {
        min-width: 15em;
        display: inline-block;
      }

      .message {
        border: 1px solid #dfdfdf;
        cursor: pointer;
        padding: 0.5em;
        margin-bottom: 0.5em;
      }

      .message:hover:before {
        content: "\02713";
        float: right;
      }

      .message.error {
        border-color: #b70f0f;
        background-color: #b70f0f;
        color: #fff;
      }

      textarea {
        width: initial !important;
        vertical-align: top;
      }

      #form-register {
        display: none;
      }

      #form-login .field label {
        min-width: 10em;
      }

      #form-login .buttons {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .register-form-fields {
        text-align: center;
      }

      .register-form h2 {
        margin-top: 3em;
      }

      .register-form button {
        padding: 0.5rem 1rem;
        background: white;
        border: 1px solid #dfdfdf;
        border-radius: 5px;
      }

      .register-form button:hover {
        background: #dfdfdf;
      }

      #choice {
        display: flex;
        justify-content: space-around;
        align-items: center;
        flex-flow: row wrap;
      }

      #choice .login {
        padding: 1em;
        border: 1px solid #dfdfdf;
        border-radius: 10px;
      }

      .choice-button {
        padding: 1rem;
        margin-right: 2rem;
        font-size: x-large;
        background: white;
        border: 2px solid #31456e;
        border-radius: 5px;
      }

      .choice-button:hover {
        background: #31456e;
        color: #fff;
      }

    </style>
  </metal:styleslot>
  <metal:javascriptslot fill-slot="javascript_head_slot">
  </metal:javascriptslot>
</head>
<body>

<metal:fill fill-slot="column_two_slot"></metal:fill>

<metal:title fill-slot="content-title">
  <h1 class="documentFirstHeading"><span tal:replace="context/title_or_id"></span> - Registration</h1>`
</metal:title>

<metal:content-core fill-slot="content-core">
<metal:block define-macro="content-core">

<p>A user account is required for registration. You can login with an existing account or create a one.</p>

<div id="choice" style="display: none">
  <div class="login" tal:define="message python:options.get('login_message', None)">
    <metal:message define-macro="message">
      <tal:message tal:condition="message">
        <div tal:attributes="class string:message ${message/type}"
          onclick="$(this).fadeOut()">
          <div tal:content="message/text"></div>
        </div>
      </tal:message>
    </metal:message>
    <form id="form-login" action="./register" name="login" method="POST" class="register-form">
      <div class="register-form-fields">
        <div class="field">
          <label for="f_username">Username</label>
          <input id="f_username" type="text" name="__ac_name" required />
        </div>
        <div class="field">
          <label>Password</label>
          <input type="password" name="__ac_password" required />
        </div>
        <div class="buttons">
          <span>
            <button type="submit" name="submit.login">Login</button>
            <a href="./">Cancel</a>
          </span>
          <a href="./mail_password_form?userid=">Forgot?</a>
        </div>
      </div>
    </form>
  </div>
  <div class="register">
    <button class="choice-button"
      onclick="meeting.show_registration()">I need an account</button>
  </div>
</div>


<form id="form-register"
  action="./register#register" name="register" method="POST" class="register-form"
  tal:define="message python:options.get('register_message', None); fields python:options.get('fields', {});">
  <h2>Personal information</h2>
  <metal:message use-macro="template/macros/message" />
  <div class="register-form-fields">
    <div class="field">
      <label>First name<span class="required"></span></label>
      <input type="text" name="first_name" required
        tal:attributes="value python:fields.get('first_name', '')" />
    </div>
    <div class="field">
      <label>Last name<span class="required"></span></label>
      <input type="text" name="last_name" required
        tal:attributes="value python:fields.get('last_name', '')" />
    </div>
    <div class="field">
      <label>Position<span class="required"></span></label>
      <input type="text" name="position" required
        tal:attributes="value python:fields.get('position', '')" />
    </div>
    <div class="field">
      <label>Organisation<span class="required"></span></label>
      <input type="text" name="organisation" required
        tal:attributes="value python:fields.get('organisation', '')" />
    </div>
    <div class="field">
      <label>Address</label>
      <textarea rows="5" cols="30" name="address"
        tal:content="python:fields.get('address', '')"></textarea>
    </div>
    <div class="field">
      <label>Country</label>
      <input type="text" name="country"
        tal:attributes="value python:fields.get('country', '')" />
    </div>
    <div class="field">
      <label>Email address<span class="required"></span></label>
      <input type="email" name="email" required
        tal:attributes="value python:fields.get('email', '')" />
    </div>
    <div class="field">
      <label>Phone numbers</label>
      <textarea rows="5" cols="30" name="phone_numbers:lines"
        tal:content="python:'\n'.join(fields.get('phone_numbers', []))"></textarea>
    </div>
  </div>

  <h2>Login details</h2>
  <div class="register-form-fields">
    <div class="field">
      <label>Username</label>
      <input type="text" name="username" required
        tal:attributes="value python:fields.get('username', '')" />
    </div>
    <div class="field">
      <label>Password</label>
      <input type="password" name="pw1" required />
    </div>
    <div class="field">
      <label>Password confirmation</label>
      <input type="password" name="pw2" required />
    </div>

    <button type="submit" name="submit.register">Register new account</button>
    <button onclick="meeting.show_choice();return false">Cancel</button>
  </div>
</form>

    <script>
    (function(){
      var elem_choice = document.getElementById('choice');
      var elem_register = document.getElementById('form-register');
      var show_registration = function(preserve_history) {
        $(elem_register).fadeIn();
        $(elem_choice).hide();
        var new_url = document.location.hash ?
          document.location.href.split(document.location.hash)[0] + '#register' :
          document.location.href + '#register';
          if (!preserve_history) {
            history.pushState(
              { action: 'show_registration' },
              'Show registration form.',
              new_url
            );
          }
      }
      var show_choice = function(preserve_history) {
        $(elem_register).hide();
        $(elem_choice).fadeIn();
        var new_url = document.location.hash ?
          document.location.href.split(document.location.hash)[0] :
          document.location.href;
        if (!preserve_history){
          history.pushState(
            { action: 'show_choice' },
            'Show choice form.',
            new_url
          );
        }
      }

      ns = {
        show_choice: show_choice,
        show_registration: show_registration
      }

      window.addEventListener('popstate', function(evt) {
        ns[evt.state.action](true);
      });

      if (document.location.hash.indexOf('#register') !== -1) {
        show_registration();
      } else {
        show_choice();
      }

      window.meeting = ns;
    })()
  </script>


</metal:block>
</metal:content-core>

</body>
</html>

