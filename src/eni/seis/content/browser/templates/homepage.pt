<html metal:use-macro="here/main_template/macros/master">
  <metal:content fill-slot="content">

    <main class="page-main" data-diazo="homepage-content">

      <!-- Moved on banner by diazo rule -->
      <p class="site-description" data-diazo="site-description" tal:content="context/description"></p>

      <!-- Countries map -->
      <section class="section"
               data-diazo="section-countries-map"
               id="countries-map-section"
               tal:define="portal_absolute_url context/portal_absolute_url;
                       map_svg_url python:portal_absolute_url + '/countries_map'">

        <div class="section-body">
          <object tal:attributes="data python:map_svg_url" type="image/svg+xml">
          </object>
        </div>
      </section><!-- Countries map -->

      <!-- Events section -->
      <section class="section"
               data-diazo="section-events"
               id="events-section"
               tal:define="events context/find_events;
                           has_events python:True if len(events) > 0 else False;">

        <header class="section-header">
          <h2 class="section-title">Events</h2>
        </header>

        <div class="section-body">
          <div class="listing block-inset">
            <div class="listing-body">
              <ul class="listing-items"
                  tal:condition="python:has_events">

                <tal:repeat tal:repeat="event python:events">
                  <li class="listing-item"
                      tal:define="event_object python:event.getObject();
                                  event_date python:event_object.getField('startDate').getAccessor(event_object)();
                                  event_start_date python:{'month': event_date.Month(), 'day': event_date.day(), 'year': event_date.year()};
                                  event_month python:event_start_date.get('month');
                                  event_day python:event_start_date.get('day');
                                  event_year python:event_start_date.get('year');
                                  event_title python:event_object.getField('title').getAccessor(event_object)();
                                  event_url python:event_object.absolute_url();
                                  event_description python:event_object.getField('description').getAccessor(event_object)();">

                    <div class="event snippet">
                      <time datetime="" class="event-date">
                        <span class="event-month" tal:content="python:event_month[:3]">Sep</span>
                        <span class="event-day" tal:content="python:event_day">25</span>
                        <span class="event-year" tal:content="python:event_year">2016</span>
                      </time>

                      <div class="event-body">
                        <h4 class="event-title">
                          <a href="" tal:content="python:event_title"
                             tal:attributes="href python:event_url">Event title</a>
                        </h4>
                        <div class="event-description">
                          <p tal:content="structure python:event_description"></p>
                        </div>
                      </div>
                    </div>
                  </li>
                </tal:repeat>
              </ul>
              <p tal:condition="python:has_events is False">No events.</p>
            </div>
          </div>
        </div>

        <footer class="section-footer"
                tal:define="portal_absolute_url context/portal_absolute_url;
                            all_events_url python:portal_absolute_url + '/events';
                            event_calendar_url python:portal_absolute_url + '/media/events-calendar';">
          <a href="" tal:attributes="href python:all_events_url">See all events</a>
          <a href="" tal:attributes="href python:event_calendar_url">See event calendar</a>
        </footer>
      </section><!-- Events section -->

    </main>
  </metal:content>
</html>
