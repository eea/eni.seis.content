<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<body>

  <metal:content-core fill-slot="content-core">

    <metal:block define-macro="listing" extend-macro="context/folder_listing/macros/content-core">

      <metal:entries fill-slot="long_description"></metal:entries>

      <metal:entries fill-slot="entries">

        <div tal:replace="structure tab/long_description | nothing" tal:on-error="nothing"></div>

        <table class="listing event-table"
               summary="Content listing"
               i18n:attributes="summary summary_content_listing;">
          <thead>
            <tr>
              <th>Event</th>
              <th>Date</th>
            </tr>
          </thead>

          <tbody>
            <metal:block use-macro="context/folder_listing/macros/entries">
              <metal:entry fill-slot="entry">

                <tr metal:define-macro="listitem" tal:define="oddrow repeat/item/odd;"
                    tal:attributes="class python:test(oddrow, 'even', 'odd')"
                    tal:condition="python:item.portal_type == 'eea.meeting'">

                  <td>
                    <div class="event-title">
                      <a href="" tal:attributes="href item/getURL" tal:content="item/Title">Item</a>
                    </div>

                    <div class="event-location">
                      <strong>Location:</strong>
                      <span tal:replace="python: context.get_event_location(item)"></span>
                    </div>

                    <div class="event-category">
                      <strong>Category:</strong>
                      <span tal:replace="python: context.get_event_type(item).capitalize()"></span>
                    </div>

                    <div tal:define="obj item/getObject" class="event-contact">
                      <strong>Contact:</strong>
                      <tal:condition tal:condition="python: hasattr(obj, 'contact_email') and hasattr(obj, 'contact_name')">
                        <a href="" tal:attributes="href python: obj.contact_email" tal:content="python: obj.contact_name">Somebody</a>
                      </tal:condition>
                    </div>

                    <div class="event-registration"
                         tal:define="meeting python:item.getObject();
                                     is_registered python:meeting.is_registered();
                                     can_register python:meeting.can_register();">

                      <tal:condition tal:condition="python:can_register is False or is_registered is True">
                        <p>
                          <strong>Registration:</strong>
                          <span tal:condition="not:can_register">Not available.</span>
                          <span tal:condition="is_registered">You are registered.</span>
                        </p>
                      </tal:condition>

                      <tal:condition tal:condition="python: is_registered is False and can_register is True">
                        <a tal:condition="python:context.portal_membership.isAnonymousUser()"
                           tal:attributes="href string:${context/absolute_url}/login?came_from=${item/getURL}"
                           class="btn event-register">
                          Login to register
                        </a>

                        <form class="form-horizontal" tal:attributes="action string:${item/getURL}/register" method="GET"
                              tal:condition="python:not context.portal_membership.isAnonymousUser()">
                          <div class="form-group" class="col-md-3">
                            <label for="form-widgets-reimbursed" class="control-label">
                                Reimbursed participation
                            </label>

                            <span class="option">
                              <label for="form-widgets-reimbursed-0">
                                <input id="form-widgets-reimbursed" name="form.widgets.reimbursed" class="radio-widget required bool-field"
                                       value="true" type="radio">
                                    <span class="label">yes</span>
                              </label>
                            </span>

                            <span class="option">
                              <label for="form-widgets-reimbursed-1">
                                <input id="form-widgets-reimbursed-1" name="form.widgets.reimbursed" class="radio-widget required bool-field"
                                       value="false" checked="checked" type="radio">
                                <span class="label">no</span>
                              </label>
                            </span>
                          </div>

                          <div class="form-group" class="col-md-3">
                            <label for="form-widgets-role"  class="control-label">
                              Role
                            </label>
                            <select id="form-widgets-role" name="form.widgets.role:list" class="select-widget required choice-field" size="1"
                                    tal:define="options python:context.restrictedTraverse('get_subscriber_roles')">
                              <tal:options tal:repeat="option options">
                                <option tal:attributes="value python:option[0]">
                                  <span tal:replace="python:option[1]">ENI-SEIS II EAST NFP</span>
                                </option>
                              </tal:options>
                            </select>

                            <div class="form-group" class="col-md-3">
                              <input class="btn event-register" type="submit" name="event-register" value="Register" />
                            </div>
                          </div>
                        </form>

                      </tal:condition>
                    </div>
                  </td>

                  <td class="event-table-date">
                    <tal:condition tal:condition="python: context.get_event_year(item) and context.get_event_dates(item)">
                      <span tal:content="python: context.get_event_year(item)">
                      </span> / <span tal:content="python:context.get_event_dates(item)"></span>
                    </tal:condition>
                  </td>

                </tr>

              </metal:entry>
            </metal:block>
          </tbody>
        </table>

        <div tal:on-error="nothing" tal:condition="python: not context.portal_membership.isAnonymousUser()">
          <form method="GET" action="" tal:attributes="action string:${tab/absolute_url}/++add++eea.meeting">
            <button type="submit" class="btn btn-default">Create a new Meeting</button>
          </form>
        </div>
      </metal:entries>
    </metal:block>

    <metal:subtopics use-macro="context/atct_topic_view/macros/folderlisting_macro" />

  </metal:content-core>

</body>
</html>
